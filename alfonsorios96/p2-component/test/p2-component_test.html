<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>p2-component test</title>

    <script src="../../webcomponentsjs/webcomponents-loader.js"></script>
    <script src="../../web-component-tester/browser.js"></script>

    <link rel="import" href="../p2-component.html">
</head>
<body>

<test-fixture id="BasicTestFixture">
    <template>
        <p2-component></p2-component>
    </template>
</test-fixture>

<test-fixture id="ChangedPropertyTestFixture">
    <template>
        <p2-component my-array='[{
            "name": "Emanuel",
        "last": "Díaz"
        },
        {
            "name": "Karla",
        "last": "D"
        }]'></p2-component>
    </template>
</test-fixture>

<script>
  suite('p2-component', () => {

    test('instantiating the element with default properties works', () => {
      const element = fixture('BasicTestFixture');
      assert.deepEqual(element.myArray, []);
      const elementShadowRoot = element.shadowRoot;
      const elementList = elementShadowRoot.querySelector('ul');
      console.log(elementList.childNodes);
      let liList = [];
      for (const node of elementList.childNodes) {
        if (node.nodeName === 'li') {
          liList.push(node);
        }
      }
      assert.equal(liList.length, 0);
    });

    test('setting a property on the element works', (done) => {
      // Create a test fixture
      const element = fixture('ChangedPropertyTestFixture');
      const arrayDummy = [ {
        name: 'Emanuel',
        last: 'Díaz'
      },
        {
          name: 'Karla',
          last: 'D'
        } ];
      assert.deepEqual(element.myArray, arrayDummy);
      const user = arrayDummy[1];
      const index = arrayDummy.indexOf(user);
      element.$.a.render();
      const input = element.shadowRoot.querySelector(`#input-${index}`);
      input.value = 'Hello !';
      const button = input.parentNode.querySelector('paper-button');
      element.addEventListener('eventito', event => {
        assert.strictEqual(event.detail, 'Hello !');
        done();
      });
      button.click();
    });

  });
</script>

</body>
</html>
